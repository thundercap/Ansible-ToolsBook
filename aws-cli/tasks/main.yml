#SPDX-License-Identifier: MIT-0
---
# tasks file for aws-cli
tasks:
    - name: Install AWS CLI v2 (idempotent)
      block:
        - name: Download AWS CLI v2 package
          get_url:
            url: "{{ aws_cli_zip_url }}"
            dest: /tmp/awscliv2.zip
            mode: "0644"

        - name: Extract AWS CLI
          unarchive:
            src: /tmp/awscliv2.zip
            dest: /tmp
            remote_src: yes

        - name: Install AWS CLI
          command: /tmp/aws/install -i /usr/local/aws-cli -b /usr/local/bin --update
          args:
            creates: /usr/local/bin/aws

        - name: Clean up installation files
          file:
            path: "{{ item }}"
            state: absent
          loop:
            - /tmp/awscliv2.zip
            - /tmp/aws
      # AWS CLI is installed on the host (not in a container) because it is a CLI tool, not a service